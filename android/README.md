# Android Tracker

##Directory Structure

* `library/` contains the core library for the Android media tracker.
* `sample/` contains an example project which uses the Android media tracker to tag events on button click as well as on video completion.

## Library

* `MediaTracker` A class that keeps track of the playback on a certain piece of media.
  * Constructor parameters:
    * `int videoDurationMS` The length in milliseconds of the media that the `MediaTracker` will track.
    * `EventTagger tagger` An interface used to handle how to tag events.  Described below.
    * (optional) `Map<String, String> userDefinedAttributes` A map of attributes that will be included in the attributes dictionary during event tagging.
  * Methods:
    * `void playAtTime(int timeInMS)` Indicate to the `MediaTracker` that playback was started at a certain time (in milliseconds).
    * `void stopAtTime(int timeInMS)` Indicate to the `MediaTracker` that playback was stopped at a certain time (in milliseconds).
    * `void complete()` Indicate to the `MediaTracker` that playback has been completed.
    * `void tagEventAtTime(int timeInMS)` This method will tell the MediaTracker to tag an event at a given time.  This method takes in a time and will update it's playback progress with that time. The method will generate a number of attributes (`Did Complete`, `Percent Played`, `Media Length (seconds)`, and `Time Played (seconds)`) in addition to the `userDefinedAttributes` input on creation.

* `EventTagger` An interface implemented by the user that will handle Event tagging logic.  The method `tagEvent` will be called when the `MediaTracker` has tagged an event.  The method will take the event name and event attributes generated by the MediaTracker. The most basic example will look similar to the following:

```java
EventTagger tagger = new EventTagger () {

  @Override
  public void tagEvent(String eventName, Map<String, String> videoAttributes) {
    Localytics.tagEvent(eventName, videoAttributes);
  }

}
```

* `TrackedVideoView` A lightweight subclass of Android's `VideoView`.  In order to track video playback include the `TrackedVideoView` in your app and set your own instance of `MediaTracker` by calling `setMediaTracker`. This class requires no additional configuration to track video playback and will be aware of a user playing, pausing, stopping, and completing the video.

##Basic Integration with TrackedVideoView
In order to intergate with the `TrackedVideoView` include an instance in your layout.

```xml
<com.localytics.library.TrackedVideoView
        android:id="@+id/video_view"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_gravity="center"/>
```

Then from your `Activity` class get a hold of it, and instantiate the `MediaTracker`.

```java
  MediaController mediaController = new MediaController(this);
  TrackedVideoView videoView = (TrackedVideoView) findViewById(R.id.video_view);
  try {
      videoView.setMediaController(mediaController);
      videoView.setVideoURI(Uri.parse(VIDEO_URL));
  } catch (Exception e) {
      Log.e("Failure instantiating videoView", e.getMessage());
  }
  MediaTracker mediaTracker;
  videoView.setOnPreparedListener(new MediaPlayer.OnPreparedListener() {
      @Override
      public void onPrepared(MediaPlayer mp) {
          mediaTracker = MediaTracker.create(videoView.getDuration(), new EventTagger() {
              @Override
              public void tagEvent(String eventName, Map<String, String> videoAttributes) {
                  Localytics.tagEvent(eventName, videoAttributes);
              }
          });
          videoView.setMediaTracker(mediaTracker);
      }
    });
```
